<!doctype html>
<html lang="es" data-bs-theme="auto">
  <head>
    <script src="../assets/js/color-modes.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Proyecto3</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="css/dashboard.css" rel="stylesheet">
  </head>

  <body>
     <!-- Íconos -->
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
      <symbol id="door-closed" viewBox="0 0 16 16">
        <path d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z"/>
        <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z"/>
      </symbol>
      <symbol id="house-fill" viewBox="0 0 16 16">
        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z"/>
        <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z"/>
      </symbol>
      <symbol id="plus-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
      </symbol>

      <symbol id="search" viewBox="0 0 16 16">
    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
  </symbol>

   <symbol id="chevron-right" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
  </symbol>

    </svg>

    <!-- Barra de navegación -->
    <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
      <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="#">Proyecto3</a>
    </header>

    <div class="container-fluid">
      <div class="row">
        <!-- Menú lateral -->
        <div class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary">
          <div class="offcanvas-md offcanvas-end bg-body-tertiary">
            <div class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3 overflow-y-auto">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link d-flex align-items-center gap-2 active" href="#">
                    <svg class="bi"><use xlink:href="#house-fill"/></svg>
                    Dashboard
                  </a>
                </li>
                <li class="nav-item">
                  <!-- Agregué id para poder seleccionar con JS -->
                  <a href="#" id="btnSubirCanciones" class="nav-link d-flex align-items-center gap-2">
                    <svg class="bi"><use xlink:href="#plus-circle"/></svg>
                    Subir Canciones
                  </a>
                </li>

                <li class="nav-item">
                  <a href="#" id="btnSubirAlbum" class="nav-link d-flex align-items-center gap-2">
                    <svg class="bi"><use xlink:href="#plus-circle"/></svg>
                    Subir Album
                  </a>
                </li>

                <li class="nav-item">
                  <a href="#" id="btnBorrarCancion" class="nav-link d-flex align-items-center gap-2">
                    <svg class="bi"><use xlink:href="#search"/></svg>
                    Buscar Artistas
                  </a>
                </li>

                <li class="nav-item">
                  <a href="#" id="btnBorrarCancion" class="nav-link d-flex align-items-center gap-2">
                    <svg class="bi"><use xlink:href="#chevron-right"/></svg>
                    Borrar Cancion
                  </a>
                </li>

                <li class="nav-item">
                  <a href="#" id="btnBorrarCancion" class="nav-link d-flex align-items-center gap-2">
                    <svg class="bi"><use xlink:href="#chevron-right"/></svg>
                    Borrar Album
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link d-flex align-items-center gap-2" href="logout">
                    <svg class="bi"><use xlink:href="#door-closed"/></svg>
                    Cerrar Sesión
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Contenido principal -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div class="pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Canciones Subidas</h1>
          </div>

          <!-- Lista de audios -->
          <ul class="list-group mb-4">
            <% if (canciones.length > 0) { %>
              <% canciones.forEach(function(cancion) { %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong><%= cancion %></strong>
                    <audio controls class="mt-2 d-block">
                      <source src="/uploads/<%= cancion %>" type="audio/mpeg">
                      Tu navegador no soporta el elemento de audio.
                    </audio>
                  </div>
                  <button class="btn btn-danger btn-sm btn-eliminar" data-cancion="<%= cancion %>">
                    Eliminar
                  </button>
                </li>
              <% }) %>
            <% } else { %>
              <li class="list-group-item">No hay canciones subidas aún.</li>
            <% } %>
          </ul>

            <div class="pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">Subir Canción</h1>
            </div>

          <!-- Formulario de subida -->
          <form id="formSubirAudio" enctype="multipart/form-data" method="POST" action="/upload">
            <div class="mb-3">
              <label for="audio" class="form-label">Seleccionar audio</label>
              <input type="file" name="audio" id="audio" class="form-control" accept="audio/*" required>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-upload"></i>  Subir Cancion
            </button>
          </form>

        </main>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/bootstrap.bundle.min.js"></script>

    <script>
      // Referencias a elementos
      const btnSubir = document.getElementById('btnSubirCanciones');
      const inputFile = document.getElementById('audio');
      const form = document.getElementById('formSubirAudio');

      // Al clickear "Subir Canciones" en el menú, abrir el selector de archivos
      btnSubir.addEventListener('click', function(e) {
        e.preventDefault();
        inputFile.click();
      });

      // Cuando se selecciona un archivo, enviar el formulario automáticamente
      inputFile.addEventListener('change', function() {
        if (inputFile.files.length > 0) {
          form.submit();
        }
      });

      document.querySelectorAll('.btn-eliminar').forEach(button => {
      button.addEventListener('click', () => {
      const nombreCancion = button.getAttribute('data-cancion');
      if(confirm(`¿Querés eliminar la canción "${nombreCancion}"?`)) {
        fetch('/delete', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ nombre: nombreCancion })
        })
        .then(res => {
          if(res.ok){
            window.location.reload();
          } else {
            alert('Error al eliminar la canción.');
          }
        })
        .catch(() => alert('Error al eliminar la canción.'));
      }
    });
  });

    </script>
  </body>
</html>
